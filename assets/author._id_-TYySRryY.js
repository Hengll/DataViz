import{V as ce,D as me}from"./DashboardCard-BWpm770L.js";import{_ as fe,u as pe,S as ge,R as ve,T as Ve,b as be,r as t,e as ye,o as n,f as z,g as e,w as a,n as f,j as u,i as M,k as v,p as A,X as q,W as D,t as d,U as y,V as _,F as H,l as _e,aj as W,ap as X,al as Y,am as G,ao as J,aq as ke,Y as he}from"./index-B8z1Igev.js";import{c as Pe,a as K,u as we,b as O}from"./index.esm-kd0_z1yQ.js";import{b as Q}from"./route-block-B_A1xBdJ.js";import{V as I,a as p}from"./VRow-C-bh6UN_.js";import{V as Z}from"./VHover-CK408gH8.js";import{V as Ce}from"./VContainer-DpCaHqNP.js";import{V as Ie}from"./VTextarea-Dv2eM3as.js";const ee={__name:"author.[id]",setup(Ne){const F=new URL(""+new URL("Sample_User_Icon-D54FHgP_.png",import.meta.url).href,import.meta.url).href,i=pe(),N=ge(),ae=ve(),{api:S,apiAuth:x}=he(),V=Ve(),{t:g}=be(),k=t(!1),le=()=>{k.value=!0},R=()=>{k.value=!1,j.value.deleteFileRecord()},h=t(!1),re=()=>{w.value.value=i.userName,C.value.value=i.userInfo,h.value=!0},T=()=>{h.value=!1,ne()},$=t(!1),B=t(!0),E=t([]),c=t({}),b=t([]),L=t([]),j=t(null);(async()=>{try{if(i.id===N.params.id)$.value=!0,c.value=i;else{const{data:r}=await S.get(`/user/profile/public/${N.params.id}`);c.value=r.result}document.title=c.value.userName+" - DataViz";const{data:l}=await S.get(`/dashboard/public/user/${N.params.id}`);E.value=l.result,B.value=!1}catch(l){console.log(l),ae.push("/")}})();const P=t(!1),se=async()=>{var l,r,m;if(P.value=!0,!((l=b.value[0])!=null&&l.error)){if(b.value.length===0){V({text:g("userPage.avatar"),snackbarProps:{color:"red"}});return}try{const s=new FormData;s.append("userName",i.userName),s.append("userInfo",i.userInfo),s.append("avatar",b.value[0].file);const{data:o}=await x.patch("/user/profile",s);i.login(o.result),R(),P.value=!1,V({text:g("userPage.uplaodSuccess"),snackbarProps:{color:"green"}})}catch(s){console.log(s),P.value=!1,V({text:g("api."+((m=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:m.message)||"unknownError"),snackbarProps:{color:"red"}})}}},oe=Pe({userName:K().required(g("api.userUserNameRequired")),userInfo:K()}),{handleSubmit:te,isSubmitting:ue,resetForm:ne}=we({validationSchema:oe}),w=O("userName"),C=O("userInfo"),de=te(async l=>{var r,m;try{const{data:s}=await x.patch("/user/profile",{userName:l.userName,userInfo:l.userInfo});i.login(s.result),T(),V({text:g("userPage.editSuccess"),snackbarProps:{color:"green"}})}catch(s){console.log(s),V({text:g("api."+((m=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:m.message)||"unknownError"),snackbarProps:{color:"red"}})}});return(l,r)=>{const m=me,s=ye("VueFileAgent");return n(),z(H,null,[e(Ce,null,{default:a(()=>[e(I,null,{default:a(()=>[e(p,{cols:"12",class:"mt-16"},{default:a(()=>[e(I,null,{default:a(()=>[e(p,{cols:"12",class:"front border border-opacity-50"}),e(p,{cols:"12",class:"user pa-16"},{default:a(()=>[e(I,null,{default:a(()=>[e(p,{cols:"12",class:"mt-4 d-flex justify-space-between"},{default:a(()=>[$.value?(n(),f(Z,{key:1},{default:a(({isHovering:o,props:U})=>[v("div",D(U,{class:"avatar",onClick:le}),[o?(n(),f(A,{key:0,class:"border border-opacity-100 opacity-50 bg-grey-lighten-3 avatar-edit",icon:"mdi-camera"})):q("",!0),e(M,{class:"border border-opacity-100 bg-orange w-100 h-100",image:c.value.avatar||u(F)},null,8,["image"])],16)]),_:1})):(n(),f(M,{key:0,class:"border border-opacity-100 bg-orange avatar",image:c.value.avatar||u(F)},null,8,["image"])),v("h2",null,d(c.value.userName),1),$.value?(n(),f(_,{key:2,"prepend-icon":"mdi-pencil",color:"primary",onClick:re},{default:a(()=>[y(d(l.$t("userPage.userEdit")),1)]),_:1})):q("",!0)]),_:1}),e(p,{cols:"12"},{default:a(()=>[v("p",null,d(c.value.userInfo||"..."),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{cols:"12",class:"pa-16"},{default:a(()=>[e(I,null,{default:a(()=>[(n(!0),z(H,null,_e(E.value,o=>(n(),f(p,{key:o._id,class:"v-col-12 v-col-sm-6 v-col-md-4 v-col-lg-3"},{default:a(()=>[e(Z,null,{default:a(({isHovering:U,props:ie})=>[v("div",D({ref_for:!0},ie,{class:"bg-secondary rounded"}),[B.value?(n(),f(ce,{key:0,type:"image, article"})):(n(),f(m,D({key:1,ref_for:!0},o,{"read-only":!0,class:{"dashboard-hover":!!U},style:{transition:"0.2s"}}),null,16,["class"]))],16)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(J,{modelValue:k.value,"onUpdate:modelValue":r[2]||(r[2]=o=>k.value=o),width:"350"},{default:a(()=>[e(W,null,{default:a(()=>[e(X,{class:"d-flex align-center"},{default:a(()=>[e(A,{icon:"mdi-upload",class:"me-1"}),v("span",null,d(l.$t("userPage.uploadAvatar")),1)]),_:1}),e(Y,null,{default:a(()=>[e(s,{ref_key:"fileAgent",ref:j,modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=o=>b.value=o),"raw-model-value":L.value,"onUpdate:rawModelValue":r[1]||(r[1]=o=>L.value=o),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":l.$t("userPage.helpText"),"error-text":{type:l.$t("fileAgent.errorType"),size:l.$t("fileAgent.errorSize")}},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),e(G,null,{default:a(()=>[e(_,{onClick:R},{default:a(()=>[y(d(l.$t("userPage.cancel")),1)]),_:1}),e(_,{variant:"flat",color:"primary",loading:P.value,onClick:se},{default:a(()=>[y(d(l.$t("userPage.upload")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(J,{modelValue:h.value,"onUpdate:modelValue":r[5]||(r[5]=o=>h.value=o),width:"600"},{default:a(()=>[e(W,null,{default:a(()=>[e(X,{class:"d-flex align-center"},{default:a(()=>[e(A,{icon:"mdi-pencil",class:"me-1"}),v("span",null,d(l.$t("userPage.userEdit")),1)]),_:1}),e(Y,null,{default:a(()=>[e(ke,{modelValue:u(w).value.value,"onUpdate:modelValue":r[3]||(r[3]=o=>u(w).value.value=o),"error-messages":u(w).errorMessage.value,label:l.$t("userPage.userName"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),e(Ie,{modelValue:u(C).value.value,"onUpdate:modelValue":r[4]||(r[4]=o=>u(C).value.value=o),"error-messages":u(C).errorMessage.value,label:l.$t("userPage.userInfo"),variant:"outlined"},null,8,["modelValue","error-messages","label"])]),_:1}),e(G,null,{default:a(()=>[e(_,{onClick:T},{default:a(()=>[y(d(l.$t("userPage.cancel")),1)]),_:1}),e(_,{variant:"flat",color:"primary",loading:u(ue),onClick:u(de)},{default:a(()=>[y(d(l.$t("userPage.confirm")),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};typeof Q=="function"&&Q(ee);const Be=fe(ee,[["__scopeId","data-v-87680c69"]]);export{Be as default};
