import{_ as U,Z as j,u as B,b as q,T as z,S as L,R as O,r as Q,d as v,o as W,f as Y,g as t,w as o,k as D,t as n,j as l,V as m,U as c,h as Z,ak as G,aq as H,p as J,am as K,ar as X,an as aa,ap as ea,F as ta,Y as sa}from"./index-BQR1Or4a.js";import{c as oa,a as k,u as da,b as y}from"./index.esm-CS1-NLrQ.js";import{M as la,A as ra,t as na,c as ia,a as ua,S as ma,_ as ca}from"./BtnDataDelete-DWQ4F5Vz.js";import{b as _}from"./route-block-B_A1xBdJ.js";import{V as fa,a as i}from"./VRow-CQeO6zcm.js";import{V as pa}from"./VDivider-BRkmoggw.js";import{V as ba}from"./VContainer-BRCrDAVa.js";import{V as ha}from"./VForm-LlD8QM_P.js";import{V as Sa}from"./VTextarea-B-AKdkwf.js";const w={__name:"data.[id]",setup(ga){const s=j(),N=B(),{apiAuth:S}=sa(),{t:u}=q(),f=z(),C=L(),I=O(),p=Q(!1),E=()=>{b.value.value=s.dashboard.dataSet.dataName,h.value.value=s.dashboard.dataSet.dataInfo,p.value=!0},g=()=>{p.value=!1,x()};(async()=>{try{const{data:e}=await S.get(`/dataSet/${C.params.id}`);s.dashboard.dataSet=e.result}catch(e){console.log(e),I.push("/")}})();const $=oa({dataName:k().required(u("api.dataNameRequired")),dataInfo:k()}),{handleSubmit:R,isSubmitting:V,resetForm:x}=da({validationSchema:$}),b=y("dataName"),h=y("dataInfo"),F=R(async e=>{var d,a;try{await S.patch(`/dataSet/${s.dashboard.dataSet._id}`,{dataName:e.dataName,data:s.dashboard.dataSet.data,dataInfo:e.dataInfo}),s.dashboard.dataSet.dataName=e.dataName,s.dashboard.dataSet.dataInfo=e.dataInfo,f({text:u("linkData.editSuccess"),snackbarProps:{color:"green"}}),g()}catch(r){console.log(r),f({text:u("api."+((a=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:a.message)||"unknownError"),snackbarProps:{color:"red"}})}});la.registerModules([ra]);const T=na.withPart(N.theme==="lightTheme"?ia:ua),A=v(()=>{var e;return(e=s.dashboard.dataSet)!=null&&e.data?s.dashboard.dataSet.data:[]}),M=v(()=>{var e,d;return(e=s.dashboard.dataSet)!=null&&e.data?[...Object.keys((d=s.dashboard.dataSet)==null?void 0:d.data[0]).map(a=>({field:a,editable:!0})),{headerName:"Actions",cellRenderer:ca}]:[]}),P=async()=>{var e,d;try{s.saveDataWithApi(),f({text:u("linkData.saveDataSuccess"),snackbarProps:{color:"green"}})}catch(a){console.log(a),f({text:u("api."+((d=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:d.message)||"unknownError"),snackbarProps:{color:"red"}})}};return(e,d)=>(W(),Y(ta,null,[t(ba,{fluid:""},{default:o(()=>[t(fa,null,{default:o(()=>[t(i,{cols:"12"},{default:o(()=>{var a,r;return[D("h1",null,n(e.$t("auth.myDataSets")+" --- "+((r=(a=l(s).dashboard)==null?void 0:a.dataSet)!=null&&r.dataName?l(s).dashboard.dataSet.dataName:"")),1)]}),_:1}),t(pa),t(i,{cols:"3"}),t(i,{cols:"6"}),t(i,{cols:"2",class:"ms-auto d-flex justify-end"},{default:o(()=>[t(m,{variant:"elevated",color:"primary",onClick:P},{default:o(()=>[c(n(e.$t("linkData.save")),1)]),_:1})]),_:1}),t(i,{cols:"6"},{default:o(()=>{var a;return[t(m,{variant:"outlined",color:"primary","prepend-icon":"mdi-plus",disabled:!((a=l(s).dashboard.dataSet)!=null&&a.data),onClick:l(s).insertRowData},{default:o(()=>[c(n(e.$t("linkData.newRow")),1)]),_:1},8,["disabled","onClick"])]}),_:1}),t(i,{cols:"6",class:"d-flex justify-end"},{default:o(()=>{var a;return[t(m,{variant:"outlined",color:"primary","prepend-icon":"mdi-pencil",disabled:!((a=l(s).dashboard.dataSet)!=null&&a.data),onClick:E},{default:o(()=>[c(n(e.$t("linkData.editDataInfo")),1)]),_:1},8,["disabled"])]}),_:1}),t(i,{cols:"12"},{default:o(()=>[t(l(ma),{"suppress-drag-leave-hides-columns":!0,"row-data":A.value,"column-defs":M.value,style:{height:"600px"},pagination:!0,theme:l(T),onCellValueChanged:d[0]||(d[0]=a=>l(s).editData(a.node.id*1,a.colDef.field,a.newValue))},null,8,["row-data","column-defs","theme"])]),_:1})]),_:1})]),_:1}),t(ea,{modelValue:p.value,"onUpdate:modelValue":d[3]||(d[3]=a=>p.value=a),width:"600"},{default:o(()=>[t(ha,{disabled:l(V),onSubmit:Z(l(F),["prevent"])},{default:o(()=>[t(G,null,{default:o(()=>[t(H,{class:"d-flex align-center"},{default:o(()=>[t(J,{icon:"mdi-pencil",class:"me-1"}),D("span",null,n(e.$t("linkData.editDataInfo")),1)]),_:1}),t(K,null,{default:o(()=>[t(X,{modelValue:l(b).value.value,"onUpdate:modelValue":d[1]||(d[1]=a=>l(b).value.value=a),"error-messages":l(b).errorMessage.value,label:e.$t("dataSet.dataName"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),t(Sa,{modelValue:l(h).value.value,"onUpdate:modelValue":d[2]||(d[2]=a=>l(h).value.value=a),"error-messages":l(h).errorMessage.value,label:e.$t("dataSet.dataInfo"),variant:"outlined"},null,8,["modelValue","error-messages","label"])]),_:1}),t(aa,null,{default:o(()=>[t(m,{onClick:g},{default:o(()=>[c(n(e.$t("dataSet.cancel")),1)]),_:1}),t(m,{variant:"flat",color:"primary",type:"submit",loading:l(V)},{default:o(()=>[c(n(e.$t("linkData.edit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};typeof _=="function"&&_(w);const Ea=U(w,[["__scopeId","data-v-0a4b2d4c"]]);export{Ea as default};
