import{Z as P,u as U,b as j,T as B,S as q,R as z,r as L,d as v,o as O,f as Q,g as t,w as s,k,t as n,j as l,V as m,U as c,h as W,ak as Y,ap as Z,p as G,al as H,aq as J,am as K,ao as X,F as aa,Y as ea}from"./index-wWJ7hh0W.js";import{c as ta,a as D,u as oa,b as y}from"./index.esm-CypUnV4V.js";import{M as sa,A as da,t as la,c as ra,a as na,S as ia,_ as ua}from"./BtnDataDelete-BQMD0vGv.js";import{b as w}from"./route-block-B_A1xBdJ.js";import{V as ma,a as i}from"./VRow-yYcUYgdG.js";import{V as ca}from"./VDivider-iYad3Hp8.js";import{V as fa}from"./VContainer-rdz3cHu4.js";import{V as pa}from"./VForm-HTXpeeMx.js";import{V as ba}from"./VTextarea-C0czovY8.js";const ha={__name:"data.[id]",setup(Sa){const o=P(),N=U(),{apiAuth:S}=ea(),{t:u}=j(),f=B(),C=q(),E=z(),p=L(!1),I=()=>{b.value.value=o.dashboard.dataSet.dataName,h.value.value=o.dashboard.dataSet.dataInfo,p.value=!0},g=()=>{p.value=!1,R()};(async()=>{try{const{data:e}=await S.get(`/dataSet/${C.params.id}`);o.dashboard.dataSet=e.result}catch(e){console.log(e),E.push("/")}})();const _=ta({dataName:D().required(u("api.dataNameRequired")),dataInfo:D()}),{handleSubmit:$,isSubmitting:V,resetForm:R}=oa({validationSchema:_}),b=y("dataName"),h=y("dataInfo"),F=$(async e=>{var d,a;try{await S.patch(`/dataSet/${o.dashboard.dataSet._id}`,{dataName:e.dataName,data:o.dashboard.dataSet.data,dataInfo:e.dataInfo}),o.dashboard.dataSet.dataName=e.dataName,o.dashboard.dataSet.dataInfo=e.dataInfo,f({text:u("linkData.editSuccess"),snackbarProps:{color:"green"}}),g()}catch(r){console.log(r),f({text:u("api."+((a=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:a.message)||"unknownError"),snackbarProps:{color:"red"}})}});sa.registerModules([da]);const T=la.withPart(N.theme==="lightTheme"?ra:na),x=v(()=>{var e;return(e=o.dashboard.dataSet)!=null&&e.data?o.dashboard.dataSet.data:[]}),A=v(()=>{var e,d;return(e=o.dashboard.dataSet)!=null&&e.data?[...Object.keys((d=o.dashboard.dataSet)==null?void 0:d.data[0]).map(a=>({field:a,editable:!0})),{headerName:"Actions",cellRenderer:ua}]:[]}),M=async()=>{var e,d;try{o.saveDataWithApi(),f({text:u("linkData.saveDataSuccess"),snackbarProps:{color:"green"}})}catch(a){console.log(a),f({text:u("api."+((d=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:d.message)||"unknownError"),snackbarProps:{color:"red"}})}};return(e,d)=>(O(),Q(aa,null,[t(fa,{fluid:""},{default:s(()=>[t(ma,null,{default:s(()=>[t(i,{cols:"12"},{default:s(()=>{var a,r;return[k("h1",null,n(e.$t("auth.myDataSets")+" --- "+((r=(a=l(o).dashboard)==null?void 0:a.dataSet)!=null&&r.dataName?l(o).dashboard.dataSet.dataName:"")),1)]}),_:1}),t(ca),t(i,{cols:"3"}),t(i,{cols:"6"}),t(i,{cols:"2",class:"ms-auto d-flex justify-end"},{default:s(()=>[t(m,{variant:"elevated",color:"primary",onClick:M},{default:s(()=>[c(n(e.$t("linkData.save")),1)]),_:1})]),_:1}),t(i,{cols:"6"},{default:s(()=>{var a;return[t(m,{variant:"outlined",color:"primary","prepend-icon":"mdi-plus",disabled:!((a=l(o).dashboard.dataSet)!=null&&a.data),onClick:l(o).insertRowData},{default:s(()=>[c(n(e.$t("linkData.newRow")),1)]),_:1},8,["disabled","onClick"])]}),_:1}),t(i,{cols:"6",class:"d-flex justify-end"},{default:s(()=>{var a;return[t(m,{variant:"outlined",color:"primary","prepend-icon":"mdi-pencil",disabled:!((a=l(o).dashboard.dataSet)!=null&&a.data),onClick:I},{default:s(()=>[c(n(e.$t("linkData.editDataInfo")),1)]),_:1},8,["disabled"])]}),_:1}),t(i,{cols:"12"},{default:s(()=>[t(l(ia),{"suppress-drag-leave-hides-columns":!0,"row-data":x.value,"column-defs":A.value,style:{height:"600px"},pagination:!0,theme:l(T),onCellValueChanged:d[0]||(d[0]=a=>l(o).editData(a.node.id*1,a.colDef.field,a.newValue))},null,8,["row-data","column-defs","theme"])]),_:1})]),_:1})]),_:1}),t(X,{modelValue:p.value,"onUpdate:modelValue":d[3]||(d[3]=a=>p.value=a),width:"600"},{default:s(()=>[t(pa,{disabled:l(V),onSubmit:W(l(F),["prevent"])},{default:s(()=>[t(Y,null,{default:s(()=>[t(Z,{class:"d-flex align-center"},{default:s(()=>[t(G,{icon:"mdi-pencil",class:"me-1"}),k("span",null,n(e.$t("linkData.editDataInfo")),1)]),_:1}),t(H,null,{default:s(()=>[t(J,{modelValue:l(b).value.value,"onUpdate:modelValue":d[1]||(d[1]=a=>l(b).value.value=a),"error-messages":l(b).errorMessage.value,label:e.$t("dataSet.dataName"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),t(ba,{modelValue:l(h).value.value,"onUpdate:modelValue":d[2]||(d[2]=a=>l(h).value.value=a),"error-messages":l(h).errorMessage.value,label:e.$t("dataSet.dataInfo"),variant:"outlined"},null,8,["modelValue","error-messages","label"])]),_:1}),t(K,null,{default:s(()=>[t(m,{onClick:g},{default:s(()=>[c(n(e.$t("dataSet.cancel")),1)]),_:1}),t(m,{variant:"flat",color:"primary",type:"submit",loading:l(V)},{default:s(()=>[c(n(e.$t("linkData.edit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};typeof w=="function"&&w(ha);export{ha as default};
