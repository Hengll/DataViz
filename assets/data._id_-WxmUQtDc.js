import{Z as P,u as U,b as j,T as B,S as q,R as z,r as L,d as v,o as O,f as Q,g as t,w as o,k as D,t as n,j as l,V as m,U as c,h as W,ak as Y,aq as Z,p as G,am as H,ar as J,an as K,ap as X,F as aa,Y as ea}from"./index-Dmk4SA0r.js";import{c as ta,a as k,u as sa,b as y}from"./index.esm-Ch7Zp0lJ.js";import{M as oa,A as da,t as la,c as ra,a as na,S as ia,_ as ua}from"./BtnDataDelete-C8VN2PEj.js";import{b as w}from"./route-block-B_A1xBdJ.js";import{V as ma,a as i}from"./VRow-k7vr7YzK.js";import{V as ca}from"./VDivider-HpGhHemK.js";import{V as fa}from"./VContainer-DIX44aNH.js";import{V as pa}from"./VForm-CzV_0abM.js";import{V as ba}from"./VTextarea-DmjlCHBK.js";const ha={__name:"data.[id]",setup(Sa){const s=P(),N=U(),{apiAuth:S}=ea(),{t:u}=j(),f=B(),C=q(),I=z(),p=L(!1),_=()=>{b.value.value=s.dashboard.dataSet.dataName,h.value.value=s.dashboard.dataSet.dataInfo,p.value=!0},g=()=>{p.value=!1,R()};(async()=>{try{const{data:e}=await S.get(`/dataSet/${C.params.id}`);s.dashboard.dataSet=e.result}catch(e){console.log(e),I.push("/")}})();const E=ta({dataName:k().required(u("api.dataNameRequired")),dataInfo:k()}),{handleSubmit:$,isSubmitting:V,resetForm:R}=sa({validationSchema:E}),b=y("dataName"),h=y("dataInfo"),F=$(async e=>{var d,a;try{await S.patch(`/dataSet/${s.dashboard.dataSet._id}`,{dataName:e.dataName,data:s.dashboard.dataSet.data,dataInfo:e.dataInfo}),s.dashboard.dataSet.dataName=e.dataName,s.dashboard.dataSet.dataInfo=e.dataInfo,f({text:u("linkData.editSuccess"),snackbarProps:{color:"green"}}),g()}catch(r){console.log(r),f({text:u("api."+((a=(d=r==null?void 0:r.response)==null?void 0:d.data)==null?void 0:a.message)||"unknownError"),snackbarProps:{color:"red"}})}});oa.registerModules([da]);const T=la.withPart(N.theme==="lightTheme"?ra:na),x=v(()=>{var e;return(e=s.dashboard.dataSet)!=null&&e.data?s.dashboard.dataSet.data:[]}),A=v(()=>{var e,d;return(e=s.dashboard.dataSet)!=null&&e.data?[...Object.keys((d=s.dashboard.dataSet)==null?void 0:d.data[0]).map(a=>({field:a,editable:!0})),{headerName:"Actions",cellRenderer:ua}]:[]}),M=async()=>{var e,d;try{s.saveDataWithApi(),f({text:u("linkData.saveDataSuccess"),snackbarProps:{color:"green"}})}catch(a){console.log(a),f({text:u("api."+((d=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:d.message)||"unknownError"),snackbarProps:{color:"red"}})}};return(e,d)=>(O(),Q(aa,null,[t(fa,{fluid:""},{default:o(()=>[t(ma,null,{default:o(()=>[t(i,{cols:"12"},{default:o(()=>{var a,r;return[D("h1",null,n(e.$t("auth.myDataSets")+" --- "+((r=(a=l(s).dashboard)==null?void 0:a.dataSet)!=null&&r.dataName?l(s).dashboard.dataSet.dataName:"")),1)]}),_:1}),t(ca),t(i,{cols:"3"}),t(i,{cols:"6"}),t(i,{cols:"2",class:"ms-auto d-flex justify-end"},{default:o(()=>[t(m,{variant:"elevated",color:"primary",onClick:M},{default:o(()=>[c(n(e.$t("linkData.save")),1)]),_:1})]),_:1}),t(i,{cols:"6"},{default:o(()=>{var a;return[t(m,{variant:"outlined",color:"primary","prepend-icon":"mdi-plus",disabled:!((a=l(s).dashboard.dataSet)!=null&&a.data),onClick:l(s).insertRowData},{default:o(()=>[c(n(e.$t("linkData.newRow")),1)]),_:1},8,["disabled","onClick"])]}),_:1}),t(i,{cols:"6",class:"d-flex justify-end"},{default:o(()=>{var a;return[t(m,{variant:"outlined",color:"primary","prepend-icon":"mdi-pencil",disabled:!((a=l(s).dashboard.dataSet)!=null&&a.data),onClick:_},{default:o(()=>[c(n(e.$t("linkData.editDataInfo")),1)]),_:1},8,["disabled"])]}),_:1}),t(i,{cols:"12"},{default:o(()=>[t(l(ia),{"suppress-drag-leave-hides-columns":!0,"row-data":x.value,"column-defs":A.value,style:{height:"600px"},pagination:!0,theme:l(T),onCellValueChanged:d[0]||(d[0]=a=>l(s).editData(a.node.id*1,a.colDef.field,a.newValue))},null,8,["row-data","column-defs","theme"])]),_:1})]),_:1})]),_:1}),t(X,{modelValue:p.value,"onUpdate:modelValue":d[3]||(d[3]=a=>p.value=a),width:"600"},{default:o(()=>[t(pa,{disabled:l(V),onSubmit:W(l(F),["prevent"])},{default:o(()=>[t(Y,null,{default:o(()=>[t(Z,{class:"d-flex align-center"},{default:o(()=>[t(G,{icon:"mdi-pencil",class:"me-1"}),D("span",null,n(e.$t("linkData.editDataInfo")),1)]),_:1}),t(H,null,{default:o(()=>[t(J,{modelValue:l(b).value.value,"onUpdate:modelValue":d[1]||(d[1]=a=>l(b).value.value=a),"error-messages":l(b).errorMessage.value,label:e.$t("dataSet.dataName"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),t(ba,{modelValue:l(h).value.value,"onUpdate:modelValue":d[2]||(d[2]=a=>l(h).value.value=a),"error-messages":l(h).errorMessage.value,label:e.$t("dataSet.dataInfo"),variant:"outlined"},null,8,["modelValue","error-messages","label"])]),_:1}),t(K,null,{default:o(()=>[t(m,{onClick:g},{default:o(()=>[c(n(e.$t("dataSet.cancel")),1)]),_:1}),t(m,{variant:"flat",color:"primary",type:"submit",loading:l(V)},{default:o(()=>[c(n(e.$t("linkData.edit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64))}};typeof w=="function"&&w(ha);export{ha as default};
