import{_ as va,Z as ga,u as Sa,b as Va,T as ka,r as b,d as z,e as ha,o as ya,f as Da,g as l,w as o,k as N,t as m,V as c,U as f,j as s,h as L,ak as O,aq as W,p as J,am as Q,ar as Y,an as Z,ap as G,F as wa,Y as $a}from"./index-B1YMRt2e.js";import{c as Ia,a as H,u as K,b as w}from"./index.esm-BcHpabeB.js";import{P as Na}from"./papaparse.min-52IOHr6V.js";import{M as Aa,A as _a,t as xa,c as Ca,a as Pa,S as Ra,_ as Ea}from"./BtnDataDelete-Db17nR2c.js";import{b as X}from"./route-block-B_A1xBdJ.js";import{V as Fa,a as v}from"./VRow-C5nTvUYu.js";import{V as Ma}from"./VSelect-CXZozOM8.js";import{V as Ta}from"./VContainer-DJratR_J.js";import{V as aa}from"./VForm-zqOHHAFU.js";import{V as ea}from"./VTextarea-3GQySq3j.js";import"./VList-BySYjOKw.js";import"./ssrBoot-iB5Zl8To.js";import"./VDivider-Cc1XVpnF.js";import"./VMenu-DYMaUhoF.js";import"./VSelectionControl-LUeN8t7Q.js";const Ua={class:"text-center"},ta={__name:"data.[id]",setup(ja){var T,U;const d=ga(),la=Sa(),{apiAuth:g}=$a(),{t:n}=Va(),i=ka(),S=b([]),V=b(((U=(T=d.dashboard)==null?void 0:T.dataSet)==null?void 0:U._id)||""),k=b(!1),oa=()=>{k.value=!0},A=()=>{k.value=!1,ra(),C.value.deleteFileRecord()},h=b(!1),sa=()=>{y.value.value=d.dashboard.dataSet.dataName,D.value.value=d.dashboard.dataSet.dataInfo,h.value=!0},_=()=>{h.value=!1,ua()},p=b([]),x=b([]),C=b(null),P=async()=>{try{const{data:e}=await g.get("/dataSet/names");S.value=e.result}catch(e){console.log(e)}};P();const R=Ia({dataName:H().required(n("api.dataNameRequired")),dataInfo:H()}),{handleSubmit:da,isSubmitting:E,resetForm:ra}=K({validationSchema:R}),$=w("dataName"),I=w("dataInfo"),na=da(async e=>{var r;if((r=p.value[0])!=null&&r.error)return;if(p.value.length===0){i({text:n("api.dataRequired"),snackbarProps:{color:"red"}});return}const t=new FileReader;t.readAsText(p.value[0].file),t.onload=async function(){var j,B;let a;if(p.value[0].file.type==="text/csv")a=Na.parse(t.result,{header:!0,skipEmptyLines:!0}).data;else if(p.value[0].file.type==="application/json"){if(a=JSON.parse(t.result),!Array.isArray(a)){i({text:n("fileReader.array"),snackbarProps:{color:"red"}});return}for(const u of a){if(typeof u!="object"||u===null||Array.isArray(u)){i({text:n("fileReader.object"),snackbarProps:{color:"red"}});return}for(const q in u)if(typeof u[q]=="object"&&u[q]!==null){i({text:n("fileReader.nested"),snackbarProps:{color:"red"}});return}}}else return;try{await g.post("/dataSet",{dataName:e.dataName,dataInfo:e.dataInfo,data:a}),await P(),await F(S.value[S.value.length-1]._id),V.value=d.dashboard.dataSet._id,i({text:n("dataSet.uploadSuccess"),snackbarProps:{color:"green"}}),A()}catch(u){console.log(u),i({text:n("api."+((B=(j=u==null?void 0:u.response)==null?void 0:j.data)==null?void 0:B.message)||"unknownError"),snackbarProps:{color:"red"}})}},t.onerror=function(){i({text:n("fileReader.fail"),snackbarProps:{color:"red"}})}}),F=async e=>{var t,r;try{await g.patch(`/dashboard/${d.dashboard._id}`,{dataSet:e}),await d.getDashboardWithAPI(d.dashboard._id),i({text:n("linkData.linkDataSuccess"),snackbarProps:{color:"green"}})}catch(a){console.log(a),i({text:n("api."+((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||"unknownError"),snackbarProps:{color:"red"}})}},{handleSubmit:ia,isSubmitting:M,resetForm:ua}=K({validationSchema:R}),y=w("dataName"),D=w("dataInfo"),ma=ia(async e=>{var t,r;try{await g.patch(`/dataSet/${d.dashboard.dataSet._id}`,{dataName:e.dataName,data:d.dashboard.dataSet.data,dataInfo:e.dataInfo}),d.dashboard.dataSet.dataName=e.dataName,d.dashboard.dataSet.dataInfo=e.dataInfo,i({text:n("linkData.editSuccess"),snackbarProps:{color:"green"}}),_()}catch(a){console.log(a),i({text:n("api."+((r=(t=a==null?void 0:a.response)==null?void 0:t.data)==null?void 0:r.message)||"unknownError"),snackbarProps:{color:"red"}})}});Aa.registerModules([_a]);const ca=xa.withPart(la.theme==="lightTheme"?Ca:Pa),fa=z(()=>{var e;return(e=d.dashboard.dataSet)!=null&&e.data?d.dashboard.dataSet.data:[]}),pa=z(()=>{var e,t;return(e=d.dashboard.dataSet)!=null&&e.data?[...Object.keys((t=d.dashboard.dataSet)==null?void 0:t.data[0]).map(r=>({field:r,editable:!0})),{headerName:"Actions",cellRenderer:Ea}]:[]}),ba=async()=>{var e,t;try{d.saveDataWithApi(),i({text:n("linkData.saveDataSuccess"),snackbarProps:{color:"green"}})}catch(r){console.log(r),i({text:n("api."+((t=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:t.message)||"unknownError"),snackbarProps:{color:"red"}})}};return(e,t)=>{const r=ha("VueFileAgent");return ya(),Da(wa,null,[l(Ta,{fluid:""},{default:o(()=>[l(Fa,null,{default:o(()=>[l(v,{cols:"12"},{default:o(()=>[N("h1",Ua,m(e.$t("editor.linkData")),1)]),_:1}),l(v,{cols:"4"},{default:o(()=>[l(c,{"prepend-icon":"mdi-upload",onClick:oa},{default:o(()=>[f(m(e.$t("linkData.new")),1)]),_:1})]),_:1}),l(v,{cols:"5"},{default:o(()=>[l(Ma,{modelValue:V.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>V.value=a),t[1]||(t[1]=a=>F(V.value))],density:"compact",variant:"outlined",label:e.$t("linkData.linkDataSelect"),items:S.value,"item-title":"dataName","item-value":"_id"},null,8,["modelValue","label","items"])]),_:1}),l(v,{cols:"2",class:"ms-auto d-flex justify-end"},{default:o(()=>[l(c,{color:"primary",onClick:ba},{default:o(()=>[f(m(e.$t("linkData.save")),1)]),_:1})]),_:1}),l(v,{cols:"6"},{default:o(()=>{var a;return[l(c,{"prepend-icon":"mdi-plus",disabled:!((a=s(d).dashboard.dataSet)!=null&&a.data),onClick:s(d).insertRowData},{default:o(()=>[f(m(e.$t("linkData.newRow")),1)]),_:1},8,["disabled","onClick"])]}),_:1}),l(v,{cols:"6",class:"d-flex justify-end"},{default:o(()=>{var a;return[l(c,{"prepend-icon":"mdi-pencil",disabled:!((a=s(d).dashboard.dataSet)!=null&&a.data),onClick:sa},{default:o(()=>[f(m(e.$t("linkData.editDataInfo")),1)]),_:1},8,["disabled"])]}),_:1}),l(v,{cols:"12"},{default:o(()=>[l(s(Ra),{"suppress-drag-leave-hides-columns":!0,"row-data":fa.value,"column-defs":pa.value,style:{height:"600px"},pagination:!0,theme:s(ca),onCellValueChanged:t[2]||(t[2]=a=>s(d).editData(a.node.id*1,a.colDef.field,a.newValue))},null,8,["row-data","column-defs","theme"])]),_:1})]),_:1})]),_:1}),l(G,{modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=a=>k.value=a),width:"600"},{default:o(()=>[l(aa,{disabled:s(E),onSubmit:L(s(na),["prevent"])},{default:o(()=>[l(O,null,{default:o(()=>[l(W,{class:"d-flex align-center"},{default:o(()=>[l(J,{icon:"mdi-upload",class:"me-1"}),N("span",null,m(e.$t("linkData.editDataInfo")),1)]),_:1}),l(Q,null,{default:o(()=>[l(Y,{modelValue:s($).value.value,"onUpdate:modelValue":t[3]||(t[3]=a=>s($).value.value=a),"error-messages":s($).errorMessage.value,label:e.$t("dataSet.dataName"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),l(ea,{modelValue:s(I).value.value,"onUpdate:modelValue":t[4]||(t[4]=a=>s(I).value.value=a),"error-messages":s(I).errorMessage.value,label:e.$t("dataSet.dataInfo"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),l(r,{ref_key:"fileAgent",ref:C,modelValue:p.value,"onUpdate:modelValue":t[5]||(t[5]=a=>p.value=a),"raw-model-value":x.value,"onUpdate:rawModelValue":t[6]||(t[6]=a=>x.value=a),accept:"application/json,text/csv",deletable:"","max-size":"3MB","help-text":e.$t("fileAgent.helpText"),"error-text":{type:e.$t("fileAgent.errorType"),size:e.$t("fileAgent.errorSize")}},null,8,["modelValue","raw-model-value","help-text","error-text"])]),_:1}),l(Z,null,{default:o(()=>[l(c,{onClick:A},{default:o(()=>[f(m(e.$t("dataSet.cancel")),1)]),_:1}),l(c,{variant:"flat",color:"primary",type:"submit",loading:s(E)},{default:o(()=>[f(m(e.$t("dataSet.upload")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]),l(G,{modelValue:h.value,"onUpdate:modelValue":t[10]||(t[10]=a=>h.value=a),width:"600"},{default:o(()=>[l(aa,{disabled:s(M),onSubmit:L(s(ma),["prevent"])},{default:o(()=>[l(O,null,{default:o(()=>[l(W,{class:"d-flex align-center"},{default:o(()=>[l(J,{icon:"mdi-pencil",class:"me-1"}),N("span",null,m(e.$t("linkData.editDataInfo")),1)]),_:1}),l(Q,null,{default:o(()=>[l(Y,{modelValue:s(y).value.value,"onUpdate:modelValue":t[8]||(t[8]=a=>s(y).value.value=a),"error-messages":s(y).errorMessage.value,label:e.$t("dataSet.dataName"),variant:"outlined"},null,8,["modelValue","error-messages","label"]),l(ea,{modelValue:s(D).value.value,"onUpdate:modelValue":t[9]||(t[9]=a=>s(D).value.value=a),"error-messages":s(D).errorMessage.value,label:e.$t("dataSet.dataInfo"),variant:"outlined"},null,8,["modelValue","error-messages","label"])]),_:1}),l(Z,null,{default:o(()=>[l(c,{onClick:_},{default:o(()=>[f(m(e.$t("dataSet.cancel")),1)]),_:1}),l(c,{variant:"flat",color:"primary",type:"submit",loading:s(M)},{default:o(()=>[f(m(e.$t("linkData.edit")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])],64)}}};typeof X=="function"&&X(ta);const ee=va(ta,[["__scopeId","data-v-efc3c73c"]]);export{ee as default};
