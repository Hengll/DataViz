import{_ as C,Z as V,c as A,R as B,T as S,b as F,u as L,a as N,r as b,$ as T,e as E,f as I,g as t,w as s,j as l,F as J,o as g,V as n,a0 as M,U as c,t as u,n as O,a1 as R,Y as U}from"./index-FwzV6aOJ.js";import{h as W}from"./html2canvas.esm-DyqYn1B1.js";import{V as j}from"./VAppBar-Bjp6DwSU.js";import{V as x}from"./VMain-Czt-F7N1.js";import{V as z}from"./VContainer--czsJmE9.js";import"./ssrBoot-CpVZhYIO.js";const P={__name:"editor",setup(Y){const a=V(),{mobile:m}=A(),h=B(),{apiAuth:f}=U(),w=S(),{t:_}=F(),y=L(),k=N();k.global.name.value=y.theme;const v=b(null),p=b(null);T(()=>{p.value=v.value.area}),a.drawer=!m.value;const D=async()=>{var e,r;try{if(a.saveLoading=!0,p.value)(await W(p.value,{allowTaint:!0,logging:!1,scale:1})).toBlob(async i=>{const $=new File([i],"thumbnail.png",{type:"image/png"}),d=new FormData;d.append("image",$),d.append("backgroundColor",a.dashboard.backgroundColor),d.append("charts",JSON.stringify(a.dashboard.charts)),await f.patch(`/dashboard/${a.dashboard._id}`,d),await a.saveDataWithApi(),a.saveLoading=!1,a.clearDashboard(),h.push("/auth")});else{const o=new FormData;o.append("charts",JSON.stringify(a.dashboard.charts)),await f.patch(`/dashboard/${a.dashboard._id}`,o),await a.saveDataWithApi(),a.saveLoading=!1,a.clearDashboard(),h.push("/auth")}}catch(o){console.log(o),w({text:_("api."+((r=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:r.message)||"unknownError"),snackbarProps:{color:"red"}}),a.saveLoading=!1}};return(e,r)=>{const o=E("router-view");return g(),I(J,null,[t(j,{location:l(m)?"top":"bottom",height:"40"},{default:s(()=>[t(z,{fluid:"",class:"d-flex align-center"},{default:s(()=>[t(n,{style:M({visibility:e.$route.name==="/editor/dashboard.[id]"?"visible":"hidden"}),class:"border-radius-none pa-1 h-25 me-1",icon:"mdi-menu",variant:"text",onClick:r[0]||(r[0]=i=>l(a).drawer=!l(a).drawer)},null,8,["style"]),t(n,{class:"pa-1 h-25 me-1 border",to:"/editor/data/"+e.$route.params.id},{default:s(()=>[c(u(e.$t("nav.linkData")),1)]),_:1},8,["to"]),t(n,{class:"pa-1 h-25 me-1 border",to:"/editor/dashboard/"+e.$route.params.id},{default:s(()=>[c(u(e.$t("nav.editDashboard")),1)]),_:1},8,["to"]),t(n,{class:"pa-1 h-25 me-1 border",to:"/editor/preview/"+e.$route.params.id},{default:s(()=>[c(u(e.$t("nav.previewDashboard")),1)]),_:1},8,["to"]),t(n,{class:"pa-1 h-25 border ms-auto",color:"primary",variant:"flat",loading:l(a).saveLoading,onClick:D},{default:s(()=>[c(u(e.$t("nav.saveAndBack")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["location"]),t(x,{ref:"captureArea"},{default:s(()=>[t(o,null,{default:s(({Component:i})=>[(g(),O(R(i),{ref_key:"childComponent",ref:v},null,512))]),_:1})]),_:1},512)],64)}}},X=C(P,[["__scopeId","data-v-a1c7915f"]]);export{X as default};
